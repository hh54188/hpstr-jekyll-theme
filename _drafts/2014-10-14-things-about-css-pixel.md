---
layout: post
title: 待定
modified: 2014-10-14
tags: [css, mobile, javascript]
image:
  feature: abstract-3.jpg
  credit: dargadgetz
  creditlink: http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/
comments: true
share: true
---

如果你是一个像我一样刚开始接触移动Web开发的前端工程师，那么你或许也遇到了和我同样遇到的问题：有太多相似的概念需要掌握和区分，并且还可能牵涉到具体的设备和硬件。没关系，这篇文章我把他们一一列举和联系起来。我们从最简单的需求出发，把这些概念串联起来。

## CSS像素是相对的

假设我们有一台非常普通的显示器，最佳分辨率为1280x800。此时我们用浏览器打开一个测试页面，浏览器最大化，页面上有一个320x200(单位：px)的红色容器，那么我们只要复制这个容器四份，从左至右依次排列，便能在宽度上占满整个浏览器，也就占据了整个屏幕。

假设情况变的复杂一点，我们将浏览器页面放大至200%（“Ctrl键”加上“+号键”）。此时会发生什么？本来只占页面四分之一宽度的容器已经占据了屏幕的一半。需要注意的是，我们既没有增加容器的宽度，也没有改变屏幕的分辨率。放大页面实际上操作的是页面的像素，**也就是我们把像素拉伸到原来的两倍了**。 这里被拉伸的像素，也就是容器的长和宽单位，我们称之为CSS像素(CSS pixel)。

CSS像素与屏幕像素1：1同样大小时：
![origin_pixel](./images/ppi/csspixels_100.gif)
CSS像素(黑色边框)开始被拉伸，此时1个CSS像素大于1个屏幕像素
![zoom_in_pixel](./images/ppi/csspixels_in.gif)

那么在未被拉伸的情况下，原始像素的大小是应该是多大呢？这是由设备的屏幕像素决定的，这里我们可以称之为物理像素（physical pixel）或者设备像素（device pixel）。大部分显示器都是基于点阵的，也就是说通过一系列的小点排成一个大矩形，每个小点显示不同的颜色来形成图像。在上面的例子中，显示器分辨率宽度为1280，也就意味着显示器上有1280个设备物理像素点。当然这里的考虑只是最佳分辨率的情况。

这里例子说明了一件非常重要的事：CSS像素从来只是一个**相对值**。 W3C从来就没有规定过一个单位的CSS像素值需要和一个设备像素值相等。

退一步来说，即使我们规定了CSS像素值需要与设备像素大小相等，但当随着手持设备距离人的远近不同，甚至每台设备上物理像素的大小不同， 设备上的CSS像素的大小也会发生变化，为了保证CSS像素在不同设备和不同距离上观测到的大小保持一致保持连贯性。W3C定义了一个CSS相对像素（CSS reference pixel）的概念

> 











## PPI

这个概念在不同上下文中意义是不同的，在这里我们只讨论在显示器上的情况。并且它经常和DPI混淆。文章的最后会介绍PPI的在其他语境中的一些情况和对DPI的区别。

PPI全称为Pixel Per Inch，译为每英寸像素取值，更确切的说法应该是像素密度，也就是衡量单位物理面积内的像素密度情况的值。对于显示器而言，像素密度与显示器尺寸与屏幕的当前分辨率有关，同一尺寸的显示器在800x600分辨与1024x768分辨率下的像素密度明显是不同的，明显后者单位面积内的像素更多，当然后者的像素密度更高。 所以针对可以调整分辨率的液晶显示器而言谈PPI是有些没有意义的。 注意这里我们仍然还没有牵扯进设备的物理像素。 原理如下图所示：

![original](./images/ppi/original.png)

我们似乎更关心移动设备的PPI情况。因为更高的PPI意味着在同一物理屏幕上能够展现更多的画面细节，也就意味着更平滑的画面。

![original](./images/ppi/original.jpg)

但同时也需要注意到，相同的图片素材，在越高的设备上会显示的越小，以下是一个像素(1 pixel)在不同PPI设备上的可见情况：

![pixel-density-1](./images/ppi/pixel-density-1.png)

也就是说如果你想让你的图片在同样尺寸高PPI和低PPI的设备上展现同样物理尺寸的话，在高PPI设备上你的图片必须具有更高的像素和更高清的细节
。因为像素Pixel的本意就是Picture Element，是图片的信息单位，像素的缩小也就意味着图片的缩小，这非常影响用户体验。如果你使用过Windows操作系统的高PPI笔记本电脑，就会遇到这样的问题，假设PPI提高了一倍，很可能程序界面缩小了4倍（长乘以宽），也有可能为了和原体验保持一致图片素材被拉伸到原来的四倍，如果软件使用的是点阵字体（.otf字体，你可以理解为使用的是位图），字体也会变得模糊。

那么可以预见一种很糟糕的情况是，假设PPI提高了一倍，很可能程序界面缩小了4倍（因为长和宽同时是原来的两倍），Windows自带的计算器程序在23寸1080P屏幕上是香烟盒大小，到了同尺寸的2160P屏幕上就只有邮票大小了，怎么用?以Surface Pro 3为例，它的默认分辨率是2160x1440，也就是说Surface这台设备的屏幕物理像素有2160x1440个点，同时默认分辨率情况下，一个点物理像素点对应于一个分辨率像素。 但因为屏幕只有12寸，像素密度非常高，于是就出现了上面的问题，各个文字和图标被缩的太小了，电脑是完全不可用的。但Windows默认将所有的文本和素材（实际上就是分辨率像素）都放大了1.5倍（在“屏幕分辨率”-“放大或缩小文本和其他项”中进行了设置），原来是一个物理像素对应一个分辨率像素，现在则是1.5个物理像素对应一个分辨率像素，因为物理像素数量是固定的，也就意味着分辨率像素缩小了，那么实际上现在的分辨率已经变成了1440(2160/1.5)x900(1440/1.5)。在2160x1440的分辨率下的原始PPI为216（由此我们可以推算出屏幕的长为10英寸），因此在放大1.5倍之后的像素密度应该是144PPI(1440/10)。但是这样的话视觉体验会不会差了很多，其实是不一定的。这个问题我们聊到DPI的时候可以再谈。同时是因为微软的历史包袱过于沉重，放大之后仍然存在问题，比如大部分软件如果使用的是点阵字体而非适量字体的话（点阵在这里可以理解为与位图类似），强制拉伸会出现字体虚化的情况。但是这样的话视觉体验会不会差了很多，其实是不一定的。这个问题我们聊到DPI的时候可以再谈。

Retina版本的Macbook Pro使用的也是同样解决办法，显示器的物理像素点实际上有2880x1880，但默认的最优分辨率只有1440x900，刚好是物理像素的一半，也就是说操作系统默认就使用了4:1的缩放。	但是这就意味一个分辨率像素面积被拓展了放大了四倍，会导致像素的颗粒增大和肉眼可见。那么如何继续发挥Retina的优势呢，苹果鼓励开发者准备两份素材，普通和高清素材，自然高清素材是普通素材面积的四倍，但系统会自动缩小到普通素材的大小，这样图像也就更加细腻了。











## Reference Pixel

但我们不得不面临设备差异化的问题，面对不同设备的物理像素和像素密度，当CSS像素不再与物理像素一比一相匹配是，那么应该如何对CSS像素取值？

W3C因此定义了一个*相对像素(reference pixel)*的[概念](http://www.w3.org/TR/CSS21/syndata.html#length-units)：

>The reference pixel is the visual angle of one pixel on a device with a pixel density of 96dpi and a distance from the reader of an arm's length. For a nominal arm's length of 28 inches, the visual angle is therefore about 0.0213 degrees. For reading at arm's length, 1px thus corresponds to about 0.26 mm (1/96 inch).

>把人以手臂长的距离看到的像素密度为96dpi的设备一个像素点定义为*相对像素*，也就是说，1px的像素对应的物理实际单位是0.26mm(1/96英寸)。同时假设人的手臂长度为28英寸，通过正切函数，我们能算出人看到一像素的夹角（下图中的α）为0.0213度

![pxangles](./images/ppi/pxangles.png)

通过参考这个相对像素，再结合设备的物理像素和手持距离，可以计算出该设备的理想像素，甚至可以推算出设备的设备像素比(devicePixelRatio)。

比如当我们手持一台像素密度为180dpi的手机时，我们假设因为屏幕较小的缘故，人会把手机拉近操作，因此我们可以假设此时人眼离手机的距离为18英寸，对比相对像素，利用三角函数公式，我们可以计算出理想的像素密度为150dpi ((28/18) * 96 = 150)

![calculate-dpr](./images/ppi/calculate-dpr.png)

因此设备的像素比为（实际像素/理想像素） devicePixelRatio = 180 / 150 = 1.2。

使用上面这样的方式计算像素比或许比较陌生，让我们看看传统的方法

>window.devicePixelRatio = physical pixels / dips





