# 如何使用Javascript实现缓动特效

## 什么是缓动特效

虽然缓动特效这个词你可能没有听说过，但是绝大部分人都使用过。最典型的场景是在实现动画的过程中，无论是早期的jQuery还是CSS3里的transition，都允许你添加一个缓动特效参数，例如 linear, ease-in, ease-out等等。添加参数的效果就是让物体的变化（速度、大小或者颜色）伴随着一定的节奏，可以是均匀的，也可以是由慢至快的。

为什么要研究这件事？因为我在使用Unity编写游戏的过程中需要使物体拟真，例如一辆汽车在移动到目标位置时通常是缓慢启动，随之加速，最后缓慢减速。这正好和缓动特效中的ease-in-out不谋而合。然而在Unity中这一切都需要通过编码完成而非像前端开发中一个参数搞定。于是在学习如何使用代码实现缓动特效之后，在这里分享给大家，其实非常简单。

## 基本原理介绍

假设一个运动中的物体，处于跑道的100米处，准备向250米处前进，计划运动时间2秒，假设我们从0秒开始计时，那么随着时间的推移，它所处的位置和当前时间的关系可以用如下函数（公式）表示：

```
function linear(time, begin, change, duration) {
    return change * (time / duration) + begin;
}
```

各个参数的意思为：
- time：当前已经运动的时间，即0到2（秒）
- begin：距离的初始值，即100（米）
- change：目标值与初始值的差值，即250 - 100 = 150（米）
- duration：运动时长，即2（秒）

这个公式的原理是，把已经运动的时长除以运动总时长，算出当前的时间进度（百分比），再将百分比乘以距离总差值换算成目前已经运动的距离差值，最后加上初始值得到最终运动进度。

那么当物体开始运动，即0秒时，根据公式物体还处于原地：150 * (0 / 2) + 100 = 100;
当物体运动了1秒之后，物体此时的位置为：150 * (1 / 2) + 100 = 175。恰好在起点和终点的中间位置
当物体运动了2秒之后，物体的位置为：150 * (2 / 2) + 100 = 250。恰好是终点位置。

以上是小学四年级的数学内容，相信各位都能掌握，没毛病。

我们再把这个公式抽象一下，假如把change函数设为1，begin值设为0，那么得到的函数会是如下所示：
```
function linear(time, duration) {
    return time/duration;
}
```

很明显这个函数返回值只会处于0到1之间。我们把这个函数的返回值当作“系数”，对于任意给定起点值和终点值，我们都能根据上面描述的原理，利用这个系数算出任意时刻的进度或者说是运动状态。最初的公式我们可以拆分为以下两个函数：
```
function factor(time, duration) {
    return time/duration;
}

function progress(time, begin, end, duration) {
    return begin + (end - begin) * factor(time / duration);
}
```