# 从美团这篇文章聊聊微前端的聚合问题

最近我打算在我的面试题库里加一道题，用于考验候选人的应用的设计能力，这个问题也来源于最近经历的真实的业务问题：

> 我目前所在的技术中台部门为公司的业务部门开发了非常多的工具应用，比如数据分析、比如A/B测试、比如部署发布平台等等。它们都是基于 React 框架，然后辅佐以不同的状态管理框架进行开发，比如 redux，mobx，又或者 dva。这些应用都是由不同的前端团队维护开发，所以不难想象大家其实重叠的开发了相同的功能或者相同的组件，比如登陆验证（都是基于公司级别的 OAuth ），比如错误处理，又比如发送消息给用户等等。
> 因为分散在不同的域名但其实又联系紧密，不便于使用，所以我们打算把它们聚合在同一个门户（站点）下，顶部显示一条导航栏，通过导航栏的菜单在当前页面下切换不同的应用。让用户有一种使用单一应用的感觉。
> 如何来设计这个聚合方案？

如果大家听说过“微服务（Microservices）”的概念的话就不难理解“微前端（Micro Frontends）”。和后端应用类似，当一个前端应用变得异常庞大以后，它会变得难以维护，同时也会变得不稳定。将大的应用拆分为小的应用能够让每个专业团队专心负责自己的功能，更易于测试、部署以及发布。

但是这样的拆分有很多，最常见的，是将单个应用拆分为多个独立的应用，通过导航栏或者动态加载来实现无缝的切换，这样的 app 甚至可以采用不同的技术栈进行构建:

![](./images/micro-front-end/multi-app.png)

甚至单个页面上的模块也可以拆分为不同的微前端由不同的团队使用不同的技术栈进行开发：

![](./images/micro-front-end/three-teams.png)

这是两个极端。其他场景包括但不限于

- 把第三方的SaaS应用进行集成，
- 把第三方私服应用进行集成（比如在公司内部部署的 gitlab）
- 又或者把应用拆分为相同技术栈不同组件的情况。

同理有时候我们也需要进行反向的操作，比如在开头的例子中，在已有多个应用的情况下，需要将它们聚合为一个单应用。

可以想象正向的自顶向下的拆分远比反向的聚合简单，因为在开发之初你们就能总结功能，约定接口，统一技术栈，提取公共组件等等；而反向聚合下一切都是未知的，任何困难都有可能发生。

说到底，其实微前端的聚合问题其实是非常复杂的，上面看到的场景细分是一类，不同技术栈之间如何突破壁垒又是另一类




## 参考资料

- [用微前端的方式搭建类单页应用](https://tech.meituan.com/fe_tiny_spa.html)
- [Micro frontends—a microservice approach to front-end web development](https://medium.com/@tomsoderlund/micro-frontends-a-microservice-approach-to-front-end-web-development-f325ebdadc16)
- [Micro Frontends](https://micro-frontends.org/)